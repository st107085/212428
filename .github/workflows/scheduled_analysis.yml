# 檔案：.github/workflows/scheduled_analysis.yml
name: Scheduled Earthquake Analysis

on:
  # 排程：每日 UTC 00:00 執行 (約台灣早上 8 點)
  schedule:
    - cron: '0 0 * * *'
  # 允許手動觸發 (作為手動更新的替代)
  workflow_dispatch: 

jobs:
  run_analysis:
    runs-on: ubuntu-latest
    
    # 設置環境變數，將觸發者的 GitHub 帳號傳遞給 Node.js 腳本
    env:
      GITHUB_ACTOR: ${{ github.actor }} 

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18' # 使用 Node.js 18 或更高版本
          
      - name: Install dependencies for script
        run: npm install
        working-directory: ./scripts # 在 scripts 資料夾內安裝依賴

      - name: Run Analysis Script and Upload to Firestore
        run: node analyze_and_upload.js
        working-directory: ./scripts
        env:
          # 從 GitHub Secrets 獲取 Firebase 服務帳戶金鑰 (必須已設定)
          FIREBASE_SERVICE_ACCOUNT_JSON: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_JSON }}
